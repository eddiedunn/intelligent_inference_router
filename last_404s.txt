============================= test session starts ==============================
platform linux -- Python 3.11.12, pytest-8.3.5, pluggy-1.5.0 -- /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/bin/python
cachedir: .pytest_cache
rootdir: /home/eddie/code/intelligent_inference_router
plugins: asyncio-0.26.0, timeout-2.3.1, anyio-4.9.0
asyncio: mode=Mode.STRICT, asyncio_default_fixture_loop_scope=None, asyncio_default_test_loop_scope=function
collecting ... [DEBUG] REDIS_URL in conftest.py: redis://:b71d1246cacd953070e92f8b@192.168.11.253:6379/0
[DEBUG] RateLimiter id in fixture: 94069515684992
collected 84 items

gemini_test.py::test_gemini ERROR                                        [  1%]
router/tests/test_apikey_registration.py::test_apikey_registration_and_auth FAILED [  2%]
router/tests/test_config.py::test_settings_load PASSED                   [  3%]
router/tests/test_import_main.py::test_import_main PASSED                [  4%]
router/tests/test_log_udp_handler.py::test_udp_handler_emit[test message] PASSED [  5%]
router/tests/test_log_udp_handler.py::test_udp_handler_emit[another log] PASSED [  7%]
router/tests/test_log_udp_handler.py::test_udp_handler_emit[udp event] PASSED [  8%]
router/tests/test_main.py::test_health PASSED                            [  9%]
router/tests/test_main.py::test_version FAILED                           [ 10%]
router/tests/test_main.py::test_config_loading PASSED                    [ 11%]
router/tests/test_main.py::test_infer_sync PASSED                        [ 13%]
router/tests/test_main.py::test_infer_async PASSED                       [ 14%]
router/tests/test_main.py::test_infer_missing_model PASSED               [ 15%]
router/tests/test_main.py::test_infer_missing_input PASSED               [ 16%]
router/tests/test_main.py::test_infer_missing_model_field PASSED         [ 17%]
router/tests/test_main.py::test_infer_invalid_payload_type PASSED        [ 19%]
router/tests/test_main.py::test_infer_empty_payload PASSED               [ 20%]
router/tests/test_main.py::test_infer_upstream_httpx_exception PASSED    [ 21%]
router/tests/test_main.py::test_infer_upstream_non_200 PASSED            [ 22%]
router/tests/test_main.py::test_infer_large_payload PASSED               [ 23%]
router/tests/test_main.py::test_infer_concurrent_requests PASSED         [ 25%]
router/tests/test_main.py::test_infer_valid_api_key PASSED               [ 26%]
router/tests/test_main.py::test_chat_completions_missing_api_key PASSED  [ 27%]
router/tests/test_main.py::test_chat_completions_invalid_api_key PASSED  [ 28%]
router/tests/test_main.py::test_chat_completions_rate_limit PASSED       [ 29%]
router/tests/test_main.py::test_infer_rate_limit FAILED                  [ 30%]
router/tests/test_main.py::test_infer_missing_api_key PASSED             [ 32%]
router/tests/test_main.py::test_infer_invalid_api_key PASSED             [ 33%]
router/tests/test_metrics.py::test_metrics_increment PASSED              [ 34%]
router/tests/test_provider_clients.py::test_chat_completions_request[OpenAIClient-/chat/completions-gpt-3.5-turbo-payload0-https://api.openai.com/v1/chat/completions-expected_headers0] PASSED [ 35%]
router/tests/test_provider_clients.py::test_chat_completions_request[AnthropicClient-/messages-claude-3.7-sonnet-payload1-https://api.anthropic.com/v1/messages-expected_headers1] PASSED [ 36%]
router/tests/test_provider_clients.py::test_chat_completions_request[GrokClient-/chat/completions-grok-1-payload2-https://api.grok.x.ai/v1/chat/completions-expected_headers2] PASSED [ 38%]
router/tests/test_provider_clients.py::test_chat_completions_request[OpenRouterClient-/chat/completions-openrouter-1-payload3-https://openrouter.ai/api/v1/chat/completions-expected_headers3] PASSED [ 39%]
router/tests/test_provider_clients.py::test_chat_completions_request[OpenLLaMAClient-/chat/completions-openllama-1-payload4-https://api.openllama.com/v1/chat/completions-expected_headers4] PASSED [ 40%]
router/tests/test_provider_clients.py::test_anthropic_completions_not_implemented PASSED [ 41%]
router/tests/test_provider_clients.py::test_provider_timeout[OpenAIClient-gpt-3.5-turbo] PASSED [ 42%]
router/tests/test_provider_clients.py::test_provider_timeout[AnthropicClient-claude-3.7-sonnet] PASSED [ 44%]
router/tests/test_provider_clients.py::test_provider_timeout[GrokClient-grok-1] PASSED [ 45%]
router/tests/test_provider_clients.py::test_provider_timeout[OpenRouterClient-openrouter-1] PASSED [ 46%]
router/tests/test_provider_clients.py::test_provider_timeout[OpenLLaMAClient-openllama-1] PASSED [ 47%]
router/tests/test_provider_clients.py::test_provider_4xx_5xx[OpenAIClient-gpt-3.5-turbo] PASSED [ 48%]
router/tests/test_provider_clients.py::test_provider_4xx_5xx[AnthropicClient-claude-3.7-sonnet] PASSED [ 50%]
router/tests/test_provider_clients.py::test_provider_4xx_5xx[GrokClient-grok-1] PASSED [ 51%]
router/tests/test_provider_clients.py::test_provider_4xx_5xx[OpenRouterClient-openrouter-1] PASSED [ 52%]
router/tests/test_provider_clients.py::test_provider_4xx_5xx[OpenLLaMAClient-openllama-1] PASSED [ 53%]
router/tests/test_provider_clients.py::test_provider_malformed_payload[OpenAIClient-gpt-3.5-turbo] PASSED [ 54%]
router/tests/test_provider_clients.py::test_provider_malformed_payload[AnthropicClient-claude-3.7-sonnet] PASSED [ 55%]
router/tests/test_provider_clients.py::test_provider_malformed_payload[GrokClient-grok-1] PASSED [ 57%]
router/tests/test_provider_clients.py::test_provider_malformed_payload[OpenRouterClient-openrouter-1] PASSED [ 58%]
router/tests/test_provider_clients.py::test_provider_malformed_payload[OpenLLaMAClient-openllama-1] PASSED [ 59%]
router/tests/test_redis_ping.py::test_redis_ping PASSED                  [ 60%]
router/tests/test_routing.py::test_routing_remote_models[gpt-3.5-turbo-openai] ERROR [ 61%]

==================================== ERRORS ====================================
________________________ ERROR at setup of test_gemini _________________________
file /home/eddie/code/intelligent_inference_router/gemini_test.py, line 4
  def test_gemini(prompt, model_name="gemini-2.5-flash-preview-04-17"):
E       fixture 'prompt' not found
>       available fixtures: _session_event_loop, anyio_backend, anyio_backend_name, anyio_backend_options, cache, capfd, capfdbinary, caplog, capsys, capsysbinary, doctest_namespace, event_loop, event_loop_policy, free_tcp_port, free_tcp_port_factory, free_udp_port, free_udp_port_factory, gemini_test.py::<event_loop>, monkeypatch, pytestconfig, record_property, record_testsuite_property, record_xml_attribute, recwarn, tmp_path, tmp_path_factory, tmpdir, tmpdir_factory, unused_tcp_port, unused_tcp_port_factory, unused_udp_port, unused_udp_port_factory
>       use 'pytest --fixtures [testpath]' for help on them.

/home/eddie/code/intelligent_inference_router/gemini_test.py:4
______ ERROR at setup of test_routing_remote_models[gpt-3.5-turbo-openai] ______
router/tests/conftest.py:92: in uvicorn_server
    raise RuntimeError("Uvicorn server did not start")
E   RuntimeError: Uvicorn server did not start
---------------------------- Captured stdout setup -----------------------------
[DEBUG] Startup: IIR_API_KEY = test-secret-key-robust
[DEBUG] RateLimiter id in main: 94563436115728
---------------------------- Captured stderr setup -----------------------------
ERROR:    Error loading ASGI app. Attribute "app" not found in module "router.main".
=================================== FAILURES ===================================
______________________ test_apikey_registration_and_auth _______________________
router/tests/test_apikey_registration.py:60: in test_apikey_registration_and_auth
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
----------------------------- Captured stdout call -----------------------------
[DEBUG] Entering create_app (TOP)
[DEBUG] create_app: before configure_udp_logging
[DEBUG] create_app: after configure_udp_logging, before FastAPI init
[DEBUG] create_app: after FastAPI init
[DEBUG] create_app: before health endpoint
[DEBUG] create_app: after health endpoint
[DEBUG] create_app: before /infer endpoint
[DEBUG] create_app: after /infer endpoint
[DEBUG] create_app: before metrics setup
[DEBUG] create_app: after metrics setup, before CORS
[DEBUG] create_app: after CORS setup, before /v1/chat/completions
[DEBUG] create_app: about to register /v1/chat/completions endpoint
[DEBUG] create_app: before metrics setup
[DEBUG] create_app: after metrics setup, before CORS
[DEBUG] create_app: after CORS setup
[DEBUG] REGISTERING /v1/chat/completions endpoint in create_app
[DEBUG] Returning app: <fastapi.applications.FastAPI object at 0x7fa2bad659d0>
[DEBUG] app type: <class 'fastapi.applications.FastAPI'> app value: <fastapi.applications.FastAPI object at 0x7fa2bad659d0>
[DEBUG] MIDDLEWARE: Incoming request path=/api/v1/apikeys body=b'{"description":"test key","priority":42}'
_________________________________ test_version _________________________________
router/tests/test_main.py:25: in test_version
    assert response.status_code == 200
E   assert 404 == 200
E    +  where 404 = <Response [404 Not Found]>.status_code
----------------------------- Captured stdout call -----------------------------
[DEBUG] Entering create_app (TOP)
[DEBUG] create_app: before configure_udp_logging
[DEBUG] create_app: after configure_udp_logging, before FastAPI init
[DEBUG] create_app: after FastAPI init
[DEBUG] create_app: before health endpoint
[DEBUG] create_app: after health endpoint
[DEBUG] create_app: before /infer endpoint
[DEBUG] create_app: after /infer endpoint
[DEBUG] create_app: before metrics setup
[DEBUG] create_app: after metrics setup, before CORS
[DEBUG] create_app: after CORS setup, before /v1/chat/completions
[DEBUG] create_app: about to register /v1/chat/completions endpoint
[DEBUG] create_app: before metrics setup
[DEBUG] create_app: after metrics setup, before CORS
[DEBUG] create_app: after CORS setup
[DEBUG] REGISTERING /v1/chat/completions endpoint in create_app
[DEBUG] Returning app: <fastapi.applications.FastAPI object at 0x7fa2ba406710>
[DEBUG] MIDDLEWARE: Incoming request path=/version body=b''
____________________________ test_infer_rate_limit _____________________________
router/tests/test_main.py:262: in test_infer_rate_limit
    assert hit_429, "Did not hit rate limit on /infer after 110 requests"
E   AssertionError: Did not hit rate limit on /infer after 110 requests
E   assert False
----------------------------- Captured stdout call -----------------------------
[DEBUG] Entering create_app (TOP)
[DEBUG] create_app: before configure_udp_logging
[DEBUG] create_app: after configure_udp_logging, before FastAPI init
[DEBUG] create_app: after FastAPI init
[DEBUG] create_app: before health endpoint
[DEBUG] create_app: after health endpoint
[DEBUG] create_app: before /infer endpoint
[DEBUG] create_app: after /infer endpoint
[DEBUG] create_app: before metrics setup
[DEBUG] create_app: after metrics setup, before CORS
[DEBUG] create_app: after CORS setup, before /v1/chat/completions
[DEBUG] create_app: about to register /v1/chat/completions endpoint
[DEBUG] create_app: before metrics setup
[DEBUG] create_app: after metrics setup, before CORS
[DEBUG] create_app: after CORS setup
[DEBUG] REGISTERING /v1/chat/completions endpoint in create_app
[DEBUG] Returning app: <fastapi.applications.FastAPI object at 0x7fa2ba4a0950>
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
[DEBUG] MIDDLEWARE: Incoming request path=/infer body=b'{"model":"musicgen","input":{"prompt":"hi"}}'
[DEBUG] IIR_API_KEY: test-secret-key-robust
[DEBUG] IIR_ALLOWED_KEYS: {'test-secret-key-robust'}
[DEBUG] Incoming header Authorization: Bearer test-secret-key-robust
[DEBUG] Extracted key: test-secret-key-robust
=============================== warnings summary ===============================
router/tests/test_main.py: 20 warnings
  /home/eddie/code/intelligent_inference_router/router/main.py:92: DeprecationWarning: Call to deprecated close. (Use aclose() instead) -- Deprecated since version 5.0.1.
    await redis_client.close()

router/tests/test_provider_clients.py::test_chat_completions_request[OpenAIClient-/chat/completions-gpt-3.5-turbo-payload0-https://api.openai.com/v1/chat/completions-expected_headers0]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_chat_completions_request[OpenAIClient-/chat/completions-gpt-3.5-turbo-payload0-https://api.openai.com/v1/chat/completions-expected_headers0]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_chat_completions_request[AnthropicClient-/messages-claude-3.7-sonnet-payload1-https://api.anthropic.com/v1/messages-expected_headers1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_chat_completions_request[AnthropicClient-/messages-claude-3.7-sonnet-payload1-https://api.anthropic.com/v1/messages-expected_headers1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_chat_completions_request[GrokClient-/chat/completions-grok-1-payload2-https://api.grok.x.ai/v1/chat/completions-expected_headers2]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_chat_completions_request[GrokClient-/chat/completions-grok-1-payload2-https://api.grok.x.ai/v1/chat/completions-expected_headers2]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_chat_completions_request[OpenRouterClient-/chat/completions-openrouter-1-payload3-https://openrouter.ai/api/v1/chat/completions-expected_headers3]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_chat_completions_request[OpenRouterClient-/chat/completions-openrouter-1-payload3-https://openrouter.ai/api/v1/chat/completions-expected_headers3]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_chat_completions_request[OpenLLaMAClient-/chat/completions-openllama-1-payload4-https://api.openllama.com/v1/chat/completions-expected_headers4]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_chat_completions_request[OpenLLaMAClient-/chat/completions-openllama-1-payload4-https://api.openllama.com/v1/chat/completions-expected_headers4]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_anthropic_completions_not_implemented
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_anthropic_completions_not_implemented' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_timeout[OpenAIClient-gpt-3.5-turbo]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_timeout[OpenAIClient-gpt-3.5-turbo]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_timeout[AnthropicClient-claude-3.7-sonnet]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_timeout[AnthropicClient-claude-3.7-sonnet]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_timeout[GrokClient-grok-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_timeout[GrokClient-grok-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_timeout[OpenRouterClient-openrouter-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_timeout[OpenRouterClient-openrouter-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_timeout[OpenLLaMAClient-openllama-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_timeout[OpenLLaMAClient-openllama-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_4xx_5xx[OpenAIClient-gpt-3.5-turbo]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_4xx_5xx[OpenAIClient-gpt-3.5-turbo]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_4xx_5xx[AnthropicClient-claude-3.7-sonnet]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_4xx_5xx[AnthropicClient-claude-3.7-sonnet]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_4xx_5xx[GrokClient-grok-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_4xx_5xx[GrokClient-grok-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_4xx_5xx[OpenRouterClient-openrouter-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_4xx_5xx[OpenRouterClient-openrouter-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_4xx_5xx[OpenLLaMAClient-openllama-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_4xx_5xx[OpenLLaMAClient-openllama-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_malformed_payload[OpenAIClient-gpt-3.5-turbo]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_malformed_payload[OpenAIClient-gpt-3.5-turbo]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_malformed_payload[AnthropicClient-claude-3.7-sonnet]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_malformed_payload[AnthropicClient-claude-3.7-sonnet]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_malformed_payload[GrokClient-grok-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_malformed_payload[GrokClient-grok-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_malformed_payload[OpenRouterClient-openrouter-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_malformed_payload[OpenRouterClient-openrouter-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

router/tests/test_provider_clients.py::test_provider_malformed_payload[OpenLLaMAClient-openllama-1]
  /home/eddie/.pyenv/versions/3.11.12/envs/3.11.12iir/lib/python3.11/site-packages/pytest_asyncio/plugin.py:1019: PytestDeprecationWarning: asyncio test 'test_provider_malformed_payload[OpenLLaMAClient-openllama-1]' requested async @pytest.fixture 'flush_redis_before_each_test' in strict mode. You might want to use @pytest_asyncio.fixture or switch to auto mode. This will become an error in future versions of flake8-asyncio.
    warnings.warn(

-- Docs: https://docs.pytest.org/en/stable/how-to/capture-warnings.html
=========================== short test summary info ============================
FAILED router/tests/test_apikey_registration.py::test_apikey_registration_and_auth
FAILED router/tests/test_main.py::test_version - assert 404 == 200
FAILED router/tests/test_main.py::test_infer_rate_limit - AssertionError: Did...
ERROR gemini_test.py::test_gemini
ERROR router/tests/test_routing.py::test_routing_remote_models[gpt-3.5-turbo-openai]
!!!!!!!!!!!!!!!!!!!!!!!!!! stopping after 5 failures !!!!!!!!!!!!!!!!!!!!!!!!!!!
============= 3 failed, 47 passed, 41 warnings, 2 errors in 10.01s =============
